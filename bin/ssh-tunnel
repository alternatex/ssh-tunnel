#!/usr/bin/env node

"use strict";

/**
 * Module dependencies
 */
var colors = require("colors");
var program = require('commander');
var tunnel = require("../lib").tunnel('');

console.log('SSH-Tunnel'.white.bold); 
console.log(('Version: '+tunnel.version).white); 

// TODO: gather program.command info from lib/prompt/* -> require-dir
program
  .version(tunnel.version)
  .option('-f, --file <file>', 'Load configuration from <file> (default: \'tunnel.json\')')
  .command('connect <name>', 'Establish connection')
  .command('copy <name> <copy>', 'Copy existing connection')
  .command('delete <name>', 'Delete connection')
  .command('update <name>', 'Update connection')
  .command('export <file>', 'Export connections to file')
  .command('import <file>', 'Import connections from file')  
  .command('install', 'Install SSH key for passwordless auth')
  .parse(process.argv);

// TODO: custom help/docs » args.length==0 triggers interactive mode, etc.
//  .command('help [cmd]', 'Display help for [cmd]')

if(program.args.length===0){
  console.log();
  console.log("Starting interactive mode".green);  
  console.log();
  
  var cli = getCLI(program); 
  cli.prompt.connection();  
}

// TODO: inject to client-commands...!!! » custom cfg-file support ...
// TODO: inject to client-commands...!!! » custom cfg-file support ...
// TODO: inject to client-commands...!!! » custom cfg-file support ...
// TODO: inject to client-commands...!!! » custom cfg-file support ...
// TODO: inject to client-commands...!!! » custom cfg-file support ...

function getCLI(program){
  var cli = require("../lib/cli");
  var filename = program.file ? program.file : 'tunnel.json';
  cli.load(filename);
  return cli;
}